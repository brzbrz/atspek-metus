<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Guess the Photo Year</title>

<style>
  body {
    font-family: sans-serif;
    text-align: center;
    padding: 10px;
  }
  img {
    max-width: 100%;
    border-radius: 8px;
  }
  input, button {
    font-size: 16px;
    padding: 8px;
    margin: 6px;
  }
</style>
</head>

<body>

<button id="login">Sign in with Google</button>

<div id="game" style="display:none">
  <img id="photo" alt="Photo">
  <div>
    <input id="year" type="number" placeholder="Year">
    <button id="guess">Guess</button>
  </div>
  <p id="result"></p>
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
/* ================= CONFIG ================= */
const CLIENT_ID = "821326663858-8a5sep85fflt516os0b2002chp91ks91.apps.googleusercontent.com";
const SCOPE = "https://www.googleapis.com/auth/photoslibrary.readonly";

/* ================= STATE ================= */
let photos = [];
let current = null;

/* ================= ELEMENTS (iPad SAFE) ================= */
const loginBtn = document.getElementById("login");
const gameDiv = document.getElementById("game");
const photoEl = document.getElementById("photo");
const yearEl = document.getElementById("year");
const resultEl = document.getElementById("result");
const guessBtn = document.getElementById("guess");

/* ================= AUTH ================= */
loginBtn.onclick = () => {
  google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPE,
    callback: token => loadPhotos(token.access_token)
  }).requestAccessToken();
};

/* ================= LOAD PHOTOS ================= */
async function loadPhotos(token) {
  const res = await fetch(
    "https://photoslibrary.googleapis.com/v1/mediaItems?pageSize=200",
    {
      headers: { Authorization: "Bearer " + token }
    }
  );

  const data = await res.json();

  if (!data.mediaItems) {
    alert("No photos returned from Google Photos.");
    return;
  }

  photos = data.mediaItems
    .map(p => ({
      year: new Date(p.mediaMetadata.creationTime).getFullYear(),
      url: p.baseUrl + "=w600"
    }))
    .filter(p => p.year >= 2014);

  if (!photos.length) {
    alert("No photos found from 2014 onwards.");
    return;
  }

  loginBtn.style.display = "none";
  gameDiv.style.display = "block";

  nextPhoto();
}

/* ================= GAME ================= */
function nextPhoto() {
  current = photos[Math.floor(Math.random() * photos.length)];
  photoEl.src = current.url;
  yearEl.value = "";
  resultEl.textContent = "";
}

function checkGuess() {
  const guess = parseInt(yearEl.value, 10);

  if (Number.isNaN(guess)) {
    resultEl.textContent = "Enter a year";
    return;
  }

  resultEl.textContent =
    guess === current.year
      ? "Correct!"
      : "It was " + current.year;

  setTimeout(nextPhoto, 1200);
}

/* ================= EVENTS ================= */
guessBtn.onclick = checkGuess;
</script>

</body>
</html>
